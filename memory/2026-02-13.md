# 2026-02-13 Notes

## Newsletter System - Fixed Routing Issue ✅

### Problem
The `messenger` and `newsletter-agent` in `agents.list` were intercepting Telegram messages instead of the main agent (Ruto). This happened because agents in the list can receive direct messages.

### Solution
1. **Removed agents from list** - Cleared `agents.list` to empty array
2. **Updated cron job** - Changed researcher to send directly to Telegram using message tool (no handoff needed)
3. **Simplified architecture**:
   ```
   Newsletter Researcher (isolated session)
       ↓ message tool directly
   Telegram (404428770)
   ```

### Cron Job Configuration
- **ID:** f47fb954-c1a1-415f-a71a-45f538c61816
- **Schedule:** 8:00 AM IST (`0 8 * * *` Asia/Kolkata)
- **Model:** openrouter/auto
- **Delivery:** announce to Telegram 404428770
- **Last Status:** OK ✅
- **Critical Fix (2026-02-14):** Sub-agents must use `sessions_send` to `agent:main:main` instead of `message` tool to ensure delivery to the active user session. The researcher was updated to target the main session for reliable Telegram routing.

### Key Learning
**Agents in `agents.list` can intercept messages!** 
- Only put agents in the list if you want them to handle direct conversations
- For background/sub-agents spawned by cron or other agents, don't add them to `agents.list`
- Use `sessions_spawn` with `agentId` parameter instead

### Final Solution (2nd Fix)
**Problem:** Messenger agent was intercepting Telegram messages instead of Ruto

**Solution:** Added explicit binding to route Telegram to main agent:
```json
{
  "bindings": [
    {
      "agentId": "main",
      "match": {
        "channel": "telegram"
      }
    }
  ],
  "agents": {
    "list": [
      {
        "id": "messenger",
        "name": "Messenger Agent",
        "tools": {"profile": "minimal", "alsoAllow": ["message"]},
        "sandbox": {"mode": "off"}
      }
    ]
  }
}
```

**How it works:**
1. Binding ensures Telegram → main agent (Ruto)
2. Messenger agent exists but can only be spawned by other agents
3. Researcher (sandboxed) spawns messenger to send newsletter
4. Messenger (unsandboxed) can use message tool to deliver

### Discord Configuration (Unchanged)
- **#newsletter channel** - Created (ID: 1471589803454632059)
- **Guild ID:** 1471559949149667340
- **No binding set** - To avoid routing issues

### Known Issues (Waiting for Upstream)
- **GLM-5 reasoning leak** (GitHub #6470) - Thinking content leaks to Discord
  - Root cause: Streaming sends thinking before deduplication runs
  - Status: OPEN, waiting for OpenClaw fix

## Session Summary
- User reported messenger agent was responding on Telegram instead of Ruto
- Identified that agents in `agents.list` intercept direct messages
- Removed messenger and newsletter-agent from list
- Updated cron to send directly without handoff
- Confirmed newsletter will run at 8:00 AM IST
