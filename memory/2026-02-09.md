# 2026-02-09 - Daily Notes

## Brave Search MCP Server

### Fixed: "Found 0 search results" Bug
- **Root Cause**: Brave Search uses SvelteKit for client-side rendering. Old selectors (`[data-loc="main"] .snippet`) don't match rendered DOM.
- **Fix**: Updated selectors to `#results .snippet:has(a.l1)` which targets organic results with title links.
- **File**: `/home/node/.openclaw/workspace/brave-scraper-mcp/src/tools/brave_search.py`
- **Commits**: `6c02b3b`, `2f9fd9f`

### Added: Slider CAPTCHA Support
- **Feature**: Detection and solving for Brave Search's "Drag the slider" CAPTCHA.
- **Implementation**:
  - Added `slider` type to `CAPTCHA_SELECTORS`
  - Implemented `_solve_slider()` method with human-like drag simulation
  - Supports both pyautogui and Playwright mouse fallback
- **Tests**: 8 new tests in `test_captcha.py` (28 total CAPTCHA tests)
- **Commit**: `2990dfa`

### Added: Browser Parity Tests
- **Purpose**: Validate MCP server content extraction matches browser-visible content.
- **Tests**: 14 new tests in `test_browser_parity.py`
- **Coverage**:
  - Navigation/sidebar removal
  - Social sharing cleanup
  - Cookie/GDPR notice removal
  - Subscription prompt removal
  - Code block preservation
  - Word count accuracy
  - Article structure preservation
- **Commit**: `0536563`

### GitHub Actions Status
- All 105 tests passing in CI (2 env-related errors for Chrome browser tests)
- Run ID: `21828834134` - SUCCESS (56s)

## Quota Issues
- Gemini CLI and image model quotas exhausted (resets in ~98h for image model)
- Browser comparison testing limited until quota resets

### AI Summary Extraction (In Progress)
- **Status**: Implementation complete, but extraction not working reliably
- **Issue**: AI summaries appear in Brave Search via `chatllm` component (streaming tokens), not static DOM
- **Selectors tried**: `[data-component="Summarizer"]`, `.summarizer-container`, `#answer-box`, `.summary`
- **Finding**: Page source shows AI content in embedded JSON with `type: "chatllm"`, not in renderable HTML elements
- **Next**: May need to intercept network responses or wait for streaming to complete
- **File**: `/home/node/.openclaw/workspace/brave-scraper-mcp/src/tools/brave_search.py`

## OpenCode + OpenRouter Integration
- **Discovery**: OpenCode DOES support OpenRouter as native provider (user correction)
- **Docs**: https://opencode.ai/docs/providers/ - supports 75+ LLM providers
- **Setup**: Run `/connect` in OpenCode TUI, search for OpenRouter, enter API key
- **Config**: Can also add models via `opencode.json`:
  ```json
  {
    "provider": {
      "openrouter": {
        "models": { "some-model": {} }
      }
    }
  }
  ```
- **Status**: No OpenRouter API key configured in OpenCode auth yet

## System Issues Detected
- **Gateway Network Errors**: Persistent `fetch failed` errors in logs
  - Telegram polling (`getUpdates`) failing repeatedly
  - Venice model discovery timing out, falling back to static catalog
  - Non-fatal but indicates network connectivity issues
- **Sandbox Environment**: 
  - `python` not available, must use `python3`
  - `openclaw` CLI not in PATH
  - Status Tracker URL: `http://status-tracker-app:8000` (not localhost)
  - Use: `TRACKER_URL="http://status-tracker-app:8000" TRACKER_AUTH_TOKEN="..." python3 scripts/tracker_api.py list`

## Commands Reference
```bash
# Test MCP server
mcporter call brave-scraper.brave_search --args '{"query": "Python programming", "count": 5}'

# Run tests locally
cd /home/node/.openclaw/workspace/brave-scraper-mcp && uv run pytest tests/ -v

# Check GitHub Actions
gh run list --limit 5
gh run view <run_id> --log

# Status Tracker from sandbox
cd /home/node/.openclaw/workspace/status-tracker
TRACKER_URL="http://status-tracker-app:8000" TRACKER_AUTH_TOKEN="d3Qb0YtAAxJ+hSvRHp0rnFBoGSKia8QDEJAIzZv5FjA=" python3 scripts/tracker_api.py list
```
